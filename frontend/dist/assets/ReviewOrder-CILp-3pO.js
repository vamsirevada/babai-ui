import{j as e}from"./index-DGMmKXcH.js";import{r as a}from"./vendor-B7V6k9id.js";import{B as b}from"./button-Cg6eyYue.js";import{I as w}from"./input-BJCEoQvc.js";import{B as F}from"./badge-Zk0ZolP1.js";import{C as D}from"./card-DCwoYgPB.js";import{X as K,k as P,l as L,m as V,n as $}from"./ui-_BmLYDKX.js";import{b as W,u as H}from"./router-BW-Fju1o.js";const G=({isOpen:s,onClose:l,item:r,onSave:t,suggestions:o=[],isLoading:c=!1})=>{const[m,f]=a.useState({material_name:"",sub_type:"",dimensions:"",quantity:1}),[C,v]=a.useState(!1),[x,_]=a.useState({});a.useEffect(()=>{s&&r&&(f({material_name:r.material_name||"",sub_type:r.sub_type||"",dimensions:r.dimensions||"",quantity:r.quantity||1}),_({}))},[s,r]),a.useEffect(()=>{if(s)return document.body.style.overflow="hidden",()=>{document.body.style.overflow="unset"}},[s]);const p=(n,j)=>{f(I=>({...I,[n]:j})),x[n]&&_(I=>({...I,[n]:null})),n==="item"&&v(j.length>0)},N=n=>{const j=Math.max(1,m.quantity+n);p("quantity",j)},q=()=>{const n={};return m.material_name.trim()||(n.material_name="Material name is required"),(!m.quantity||m.quantity<1)&&(n.quantity="Quantity must be at least 1"),_(n),Object.keys(n).length===0},S=()=>{q()&&t(m)},h=n=>{p("material_name",n),v(!1)},k=o.filter(n=>n.toLowerCase().includes(m.material_name.toLowerCase())&&n.toLowerCase()!==m.material_name.toLowerCase()).slice(0,5);return s?e.jsx("div",{className:"fixed inset-0 z-50 bg-brand-charcoal bg-opacity-50 flex items-end sm:items-center justify-center p-0 sm:p-4",children:e.jsxs("div",{className:"bg-brand-white w-full h-full sm:h-auto sm:max-w-md sm:rounded-xl overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-brand-charcoal/20 bg-brand-white sticky top-0 z-10",children:[e.jsx("h2",{className:"text-lg font-semibold text-brand-charcoal font-heading",children:r?.id?"Edit Item":"Add Item"}),e.jsx(b,{variant:"ghost",size:"sm",onClick:l,className:"h-8 w-8 p-0 hover:bg-brand-charcoal/10","aria-label":"Close modal",children:e.jsx(K,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"p-4 space-y-4 max-h-[calc(100vh-140px)] overflow-y-auto",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-brand-charcoal font-body",children:"Item Name *"}),e.jsxs("div",{className:"relative",children:[e.jsx(w,{type:"text",value:m.material_name,onChange:n=>p("material_name",n.target.value),placeholder:"Enter material name",className:`h-12 ${x.material_name?"border-functional-danger":""}`,"aria-describedby":x.material_name?"material_name-error":void 0}),x.material_name&&e.jsx("p",{id:"material_name-error",className:"text-sm text-functional-danger mt-1 font-body",children:x.material_name}),C&&k.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 bg-brand-white border border-brand-charcoal/20 rounded-lg shadow-lg mt-1 z-20 max-h-40 overflow-y-auto",children:k.map((n,j)=>e.jsx("button",{type:"button",className:"w-full px-3 py-3 text-left hover:bg-brand-charcoal/5 first:rounded-t-lg last:rounded-b-lg transition-colors text-sm font-body",onClick:()=>h(n),children:n},j))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-brand-charcoal font-body",children:"Subtype"}),e.jsx(w,{type:"text",value:m.sub_type,onChange:n=>p("subtype",n.target.value),placeholder:"Enter subtype",className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-brand-charcoal font-body",children:"Size/Unit"}),e.jsx(w,{type:"text",value:m.dimensions,onChange:n=>p("dimensions",n.target.value),placeholder:"Enter size or unit",className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-brand-charcoal font-body",children:"Quantity *"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(b,{type:"button",variant:"outline",size:"sm",onClick:()=>N(-1),disabled:m.quantity<=1,className:"h-12 w-12 rounded-lg","aria-label":"Decrease quantity",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),e.jsx(w,{type:"number",value:m.quantity,onChange:n=>p("quantity",parseInt(n.target.value)||1),className:`h-12 text-center flex-1 ${x.quantity?"border-functional-danger":""}`,min:"1","aria-describedby":x.quantity?"quantity-error":void 0}),e.jsx(b,{type:"button",variant:"outline",size:"sm",onClick:()=>N(1),className:"h-12 w-12 rounded-lg","aria-label":"Increase quantity",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]}),x.quantity&&e.jsx("p",{id:"quantity-error",className:"text-sm text-functional-danger font-body",children:x.quantity})]})]}),e.jsx("div",{className:"p-4 border-t border-brand-charcoal/20 bg-brand-charcoal/5 sticky bottom-0",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(b,{variant:"outline",onClick:l,className:"flex-1 h-12",disabled:c,children:"Cancel"}),e.jsx(b,{onClick:S,disabled:c,className:"flex-1 h-12 bg-brand-charcoal hover:bg-brand-charcoal/90 text-brand-white font-body",children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-brand-white border-t-transparent rounded-full animate-spin mr-2"}),"Saving..."]}):"Save Changes"})]})})]})}):null},J=s=>{const[l,r]=a.useState(!1);return a.useEffect(()=>{const t=window.matchMedia(s);t.matches!==l&&r(t.matches);const o=()=>r(t.matches);return window.addEventListener("resize",o),t.addEventListener("change",o),()=>{window.removeEventListener("resize",o),t.removeEventListener("change",o)}},[l,s]),l},X=()=>J("(max-width: 767px)");var Y={};const Z=()=>({baseUrl:Y.REACT_APP_API_URL||"/api",strategy:"amplify-production"}),z=Z(),M=z.baseUrl;console.log(`🚀 API Configuration: ${z.strategy}`);console.log(`📡 API Base URL: ${M}`);const ee=async(s,l={})=>{const r=`${M}${s}`,t={headers:{"Content-Type":"application/json"}},o={...t,...l,headers:{...t.headers,...l.headers}};try{console.log(`📤 API Request: ${o.method||"GET"} ${r}`);const c=await fetch(r,o);if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);const m=await c.json();return console.log(`📥 API Response: ${r}`,m),m}catch(c){throw console.error(`❌ API Error: ${r}`,c),c}},R=(s,l={})=>{const r=s.startsWith("/")?s:`/${s}`;return ee(r,l)},E=a.memo(({value:s,onSave:l,inputType:r="text"})=>{const[t,o]=a.useState(!1),[c,m]=a.useState(s),f=a.useRef(null);a.useEffect(()=>{t&&f.current&&(f.current.focus(),f.current.select())},[t]);const C=()=>{c!==s&&l(c),o(!1)},v=()=>{m(s),o(!1)};return t?e.jsx(w,{ref:f,type:r,value:c,onChange:x=>m(x.target.value),onBlur:C,onKeyDown:x=>{x.key==="Enter"&&C(),x.key==="Escape"&&v()},className:"h-8 text-sm",min:r==="number"?1:void 0}):e.jsxs("div",{className:"flex items-center justify-between cursor-pointer group w-full h-full p-2 -m-2 rounded-md",onClick:()=>o(!0),children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:s||e.jsx("span",{className:"text-gray-400 italic",children:"Click to add..."})}),e.jsx(P,{className:"h-3 w-3 text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity"})]})}),se=a.memo(()=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-brand-charcoal to-brand-charcoal/90 rounded-xl flex items-center justify-center shadow-md",children:e.jsx("span",{className:"text-brand-white font-bold text-sm font-heading",children:"B"})}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-gradient-to-br from-brand-charcoal/80 to-brand-charcoal rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-brand-white text-xs font-bold font-heading",children:"ai"})})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg sm:text-xl font-bold text-brand-charcoal font-heading",children:"bab.ai"}),e.jsx("p",{className:"text-xs sm:text-sm text-brand-charcoal/70 font-body",children:"Order Review"})]})]})),te=a.memo(({row:s,onCellEdit:l,onDeleteRow:r})=>e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("td",{className:"bg-white px-4 py-2 border-b border-gray-200",children:e.jsx(E,{value:s.material_name,onSave:t=>l(s.id,"material_name",t)})}),e.jsx("td",{className:"bg-white px-4 py-2 border-b border-gray-200",children:e.jsx(E,{value:s.sub_type,onSave:t=>l(s.id,"sub_type",t)})}),e.jsx("td",{className:"bg-white px-4 py-2 border-b border-gray-200",children:e.jsx(E,{value:s.dimensions,onSave:t=>l(s.id,"dimensions",t)})}),e.jsx("td",{className:"bg-white px-4 py-2 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(b,{variant:"outline",size:"sm",onClick:()=>l(s.id,"quantity",Math.max(1,(s.quantity||1)-1)),disabled:s.quantity<=1,className:"h-8 w-8 p-0",children:e.jsx(V,{className:"h-3 w-3"})}),e.jsx(w,{type:"number",value:s.quantity||1,onChange:t=>l(s.id,"quantity",parseInt(t.target.value)||1),className:"h-8 w-16 text-center text-sm",min:"1"}),e.jsx(b,{variant:"outline",size:"sm",onClick:()=>l(s.id,"quantity",(s.quantity||1)+1),className:"h-8 w-8 p-0",children:e.jsx(L,{className:"h-3 w-3"})})]})}),e.jsx("td",{className:"px-4 py-2 border-b border-gray-200 text-center",children:e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>r(s.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50 h-8 w-8 p-0",children:e.jsx($,{className:"h-4 w-4"})})})]})),ae=a.memo(({item:s,onEdit:l,onDelete:r})=>e.jsxs(D,{className:"p-4 mb-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s.material_name||e.jsx("span",{className:"text-gray-400 italic",children:"Unnamed item"})}),s.sub_type&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.sub_type})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{variant:"outline",size:"sm",onClick:()=>l(s),className:"h-9 w-9 p-0",children:e.jsx(P,{className:"h-4 w-4"})}),e.jsx(b,{variant:"outline",size:"sm",onClick:()=>r(s.id),className:"h-9 w-9 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx($,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Size/Unit:"}),e.jsx("p",{className:"font-medium mt-1",children:s.dimensions||e.jsx("span",{className:"text-gray-400 italic",children:"Not specified"})})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-gray-500",children:"Quantity:"}),e.jsx("p",{className:"font-medium mt-1",children:s.quantity||1})]})]})]})),re=()=>{const[s]=W(),l=H(),r=X(),t=s.get("uuid"),[o,c]=a.useState([]),[m,f]=a.useState([]),[C,v]=a.useState(!0),[x,_]=a.useState(!1),[p,N]=a.useState(null),[q,S]=a.useState(!1),[h,k]=a.useState({name:s.get("name")||"Rajesh Kumar",phone:s.get("phone")||"+91 98765 43210",site:s.get("site")||"Residential Construction - Phase 2",address:s.get("address")||"123 Construction Site, Bangalore, Karnataka 560001",whatsappName:s.get("name")||"Rajesh Kumar",whatsappPhone:s.get("phone")||"+91 98765 43210"});a.useEffect(()=>{(async()=>{v(!0);try{const d=[R("projects")];t&&d.push(R(`review-order/${t}`));const[u,y]=await Promise.all(d);if(u?.ok){const g=await u.json()||[];f(Array.isArray(g)?g:[])}if(t&&y?.ok){const g=await y.json()||[],U=Array.isArray(g)?g.map((A,Q)=>({id:A.id||Date.now()+Q,...A})):[{id:Date.now(),...g}];c(U)}}catch(d){console.error("Error loading data:",d)}finally{v(!1)}})()},[t]);const n=a.useCallback((i,d,u)=>{c(y=>y.map(g=>g.id===i?{...g,[d]:u}:g))},[]),j=a.useCallback(i=>{c(d=>d.filter(u=>u.id!==i))},[]),I=a.useCallback(()=>{const d={id:Date.now(),material_name:"",sub_type:"",dimensions:"",quantity:1,unit_price:0};c(u=>[...u,d]),r&&(N(d),S(!0))},[r]),B=a.useCallback(i=>{N(i),S(!0)},[]),O=a.useCallback(async i=>{c(d=>d.map(u=>u.id===p.id?{...u,...i}:u)),S(!1),N(null)},[p]),T=a.useCallback(async()=>{if(o.filter(d=>!d.material_name?.trim()||!d.quantity||d.quantity<=0).length>0){alert("Please fill in all required fields (Item name and valid quantity)");return}if(!h.address.trim()){alert("Please enter a delivery address.");return}_(!0);try{const d=crypto.randomUUID?.()||Date.now().toString(),u={request_id:t,project_id:d,sender_id:h.whatsappPhone.replace(/\D/g,""),status:"DRAFT",delivery_location:h.address,notes:`Order placed via BAB.AI Dashboard for ${h.site}. Customer: ${h.whatsappName}`,expected_delivery_date:new Date(Date.now()+7*24*60*60*1e3).toISOString().split("T")[0],user_editable:!0,items:o.map(y=>({material_name:y.material_name,sub_type:y.sub_type||null,dimensions:y.dimensions||null,quantity:y.quantity||1,quantity_units:"units",unit_price:y.unit_price||null,status:"DRAFT"})),customerInfo:h,timestamp:new Date().toISOString()};localStorage.setItem("orderData",JSON.stringify(u)),l(`/select-vendors?uuid=${t}`,{state:{orderData:u}})}catch(d){console.error("Order submission failed:",d),alert(`Order submission failed: ${d.message}`)}finally{_(!1)}},[o,h,l,t]);return C?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-gray-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading your order..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 px-2 sm:px-4 lg:px-6 xl:px-8 py-6",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-40 shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(se,{}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 sm:w-10 sm:h-10 bg-gray-800 rounded-full",children:e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.484 3.488"})})}),e.jsxs("div",{className:"text-right hidden sm:block",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:h.name}),e.jsx("div",{className:"text-xs text-gray-500",children:h.phone})]})]})]})})}),e.jsxs("div",{className:"max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 xl:px-12 2xl:px-16 py-4 sm:py-6",children:[e.jsx(D,{className:"p-4 sm:p-6 mb-4 sm:mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2",children:"Select Site/Project *"}),e.jsxs("select",{value:h.site,onChange:i=>k({...h,site:i.target.value}),className:"w-full px-3 py-2 text-sm sm:text-base border border-gray-300 rounded-md focus:ring-2 focus:ring-gray-500 focus:border-gray-500",children:[e.jsx("option",{value:"",children:"Choose your project..."}),m.map(i=>e.jsx("option",{value:i.name,children:i.name},i.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2",children:"Delivery Address *"}),e.jsx(w,{value:h.address,onChange:i=>k({...h,address:i.target.value}),placeholder:"Enter delivery address",className:"text-sm sm:text-base",required:!0})]})]})}),e.jsxs(D,{className:"p-4 sm:p-6 mb-4 sm:mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-base sm:text-lg font-semibold",children:"Order Items"}),e.jsxs(F,{className:"bg-gray-100 text-gray-700 px-2 sm:px-3 py-1 text-xs sm:text-sm",children:[o.length," items"]})]}),e.jsxs(b,{onClick:I,className:"bg-brand-charcoal hover:bg-brand-charcoal/90 text-brand-white h-9 sm:h-10 px-3 sm:px-4 font-body text-sm sm:text-base",children:[e.jsx(L,{className:"w-4 h-4 mr-1 sm:mr-2"}),"Add Item"]})]}),!r&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse bg-white",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-gray-200",children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Material Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Sub Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Dimensions"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold text-gray-700",children:"Action"})]})}),e.jsx("tbody",{children:o.map(i=>e.jsx(te,{row:i,onCellEdit:n,onDeleteRow:j},i.id))})]})}),r&&e.jsx("div",{className:"space-y-3",children:o.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{children:"No items added yet."}),e.jsx("p",{className:"text-sm mt-1",children:'Tap "Add" to get started.'})]}):o.map(i=>e.jsx(ae,{item:i,onEdit:B,onDelete:j},i.id))})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 sticky bottom-0 bg-gray-50 py-4 -mx-4 px-4 border-t border-gray-200 sm:border-t-0 sm:bg-transparent sm:relative sm:py-0 sm:mx-0",children:[e.jsx(b,{variant:"outline",className:"flex-1 h-12",onClick:()=>window.history.back(),disabled:x,children:"Back to WhatsApp"}),e.jsx(b,{onClick:T,disabled:x||o.length===0,className:"flex-1 bg-brand-charcoal hover:bg-brand-charcoal/90 h-12 font-medium text-brand-white font-body",children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"}),"Listing Vendors..."]}):"Select Vendor"})]})]}),e.jsx(G,{isOpen:q,onClose:()=>{S(!1),N(null)},item:p,onSave:O,isLoading:x})]})},he=a.memo(re);export{he as default};
