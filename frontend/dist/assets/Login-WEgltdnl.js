import{i as D,j as e,p as B}from"./index-DGMmKXcH.js";import{B as i}from"./button-Cg6eyYue.js";import{C as M,a as O,b as $,d as T,c as q}from"./card-DCwoYgPB.js";import{I as w}from"./input-BJCEoQvc.js";import{L as j}from"./label-BNILcqP_.js";import{r as c}from"./vendor-B7V6k9id.js";import{P as U}from"./PrefetchLink-B3eS15To.js";import{u as V}from"./router-BW-Fju1o.js";import{h as H,E as J,i as Y,L as v,Q as z,C as Q}from"./ui-_BmLYDKX.js";const u=({className:p="w-5 h-5"})=>e.jsx("svg",{viewBox:"0 0 24 24",className:p,fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.484 3.488"})}),ae=()=>{const p=V(),{toast:o}=D(),[x,k]=c.useState(!1),[d,m]=c.useState(!1),[r,n]=c.useState({}),[h,y]=c.useState("email"),[g,b]=c.useState(1),[f,A]=c.useState(""),[t,W]=c.useState({email:"",password:"",phoneNumber:""}),N=s=>{W({...t,[s.target.name]:s.target.value}),r[s.target.name]&&n({...r,[s.target.name]:""})},S=()=>{const s={};return h==="email"?(t.email?/\S+@\S+\.\S+/.test(t.email)||(s.email="Please enter a valid email address"):s.email="Email is required",t.password?t.password.length<6&&(s.password="Password must be at least 6 characters"):s.password="Password is required"):h==="whatsapp"&&(t.phoneNumber.trim()?/^\+?[\d\s\-\(\)]{10,}$/.test(t.phoneNumber.trim())||(s.phoneNumber="Please enter a valid phone number"):s.phoneNumber="Phone number is required"),n(s),Object.keys(s).length===0},P=(s,a)=>{const l=`Hi! I want to sign in to my bab.ai account. My verification code is: ${a}`;return`https://wa.me/+919876543210?text=${encodeURIComponent(l)}`},I=async s=>{if(s.preventDefault(),!!S()){m(!0);try{const a=Math.random().toString(36).substring(2,8).toUpperCase();A(a),await new Promise(C=>setTimeout(C,1500));const l={phoneNumber:t.phoneNumber,verificationCode:a,timestamp:new Date().toISOString(),expiresAt:new Date(Date.now()+15*60*1e3).toISOString()};localStorage.setItem("pendingWhatsAppLogin",JSON.stringify(l)),b(2),o({title:"WhatsApp login initiated!",description:"Please send the message via WhatsApp to sign in."})}catch(a){console.error("WhatsApp login error:",a),n({general:"Failed to initiate WhatsApp login. Please try again."}),o({variant:"destructive",title:"Error",description:"Failed to initiate WhatsApp login."})}finally{m(!1)}}},L=async()=>{m(!0);try{await new Promise(l=>setTimeout(l,2e3));const a=JSON.parse(localStorage.getItem("registeredUsers")||"[]").find(l=>l.phoneNumber===t.phoneNumber);if(!a){n({general:"No account found with this phone number. Please register first."}),o({variant:"destructive",title:"Account not found",description:"Please register first or try a different login method."});return}localStorage.setItem("user",JSON.stringify({email:a.email,name:`${a.firstName} ${a.lastName}`,phoneNumber:a.phoneNumber,token:"whatsapp-login-token-"+Date.now()})),localStorage.removeItem("pendingWhatsAppLogin"),b(3),o({title:"Welcome back!",description:"You have successfully signed in via WhatsApp."}),setTimeout(()=>{p("/dashboard")},2e3)}catch(s){console.error("Verification error:",s),n({general:"Verification failed. Please try again."}),o({variant:"destructive",title:"Verification failed",description:"Please try again or contact support."})}finally{m(!1)}},E=async s=>{if(s.preventDefault(),!!S()){m(!0);try{await new Promise(a=>setTimeout(a,1500)),t.email==="demo@bab.ai"&&t.password==="demo123"?(localStorage.setItem("user",JSON.stringify({email:t.email,name:"Demo User",token:"demo-token-"+Date.now()})),o({title:"Welcome back!",description:"You have successfully signed in to bab.ai"}),p("/dashboard")):(n({general:"Invalid email or password. Try demo@bab.ai with password: demo123"}),o({variant:"destructive",title:"Sign in failed",description:"Invalid email or password. Please try again."}))}catch(a){console.error("Login error:",a),n({general:"Something went wrong. Please try again later."}),o({variant:"destructive",title:"Error",description:"Failed to sign in. Please try again later."})}finally{m(!1)}}},F=()=>{p("/")};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs(i,{variant:"ghost",onClick:F,className:"mb-6 text-gray-600 hover:text-gray-900",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Back to Home"]}),e.jsxs(M,{className:"shadow-xl border-0",children:[e.jsxs(O,{className:"text-center pb-6",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-primary rounded-xl flex items-center justify-center shadow-lg",children:e.jsx("span",{className:"text-brand-white font-bold text-xl font-heading",children:"B"})}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-5 h-5 bg-gradient-to-r from-brand-accent to-brand-accent rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-brand-white text-xs font-bold font-heading",children:"ai"})})]})}),e.jsx($,{className:"text-2xl font-bold text-gray-900",children:"Welcome back"}),e.jsx(T,{className:"text-gray-600",children:h==="email"?"Sign in to your bab.ai account":"Sign in via WhatsApp for quick access"}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx(i,{type:"button",variant:h==="email"?"default":"outline",size:"sm",onClick:()=>{y("email"),b(1),n({})},className:"flex-1",children:"Email"}),e.jsxs(i,{type:"button",variant:h==="whatsapp"?"default":"outline",size:"sm",onClick:()=>{y("whatsapp"),n({})},className:"flex-1 bg-functional-success hover:bg-functional-success/90 text-brand-white border-functional-success font-body",children:[e.jsx(u,{className:"w-4 h-4 mr-1"}),"WhatsApp"]})]})]}),e.jsxs(q,{children:[r.general&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:e.jsx("p",{className:"text-sm text-red-600",children:r.general})}),h==="email"?e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"email",children:"Email"}),e.jsx(w,{id:"email",name:"email",type:"email",placeholder:"Enter your email (try: demo@bab.ai)",value:t.email,onChange:N,required:!0,className:`w-full ${r.email?"border-red-500 focus:border-red-500":""}`}),r.email&&e.jsx("p",{className:"text-sm text-red-600",children:r.email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(w,{id:"password",name:"password",type:x?"text":"password",placeholder:"Enter your password (try: demo123)",value:t.password,onChange:N,required:!0,className:`w-full pr-10 ${r.password?"border-red-500 focus:border-red-500":""}`}),e.jsx(i,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>k(!x),children:x?e.jsx(J,{className:"h-4 w-4 text-gray-400"}):e.jsx(Y,{className:"h-4 w-4 text-gray-400"})})]}),r.password&&e.jsx("p",{className:"text-sm text-red-600",children:r.password})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(i,{variant:"link",className:"px-0 text-sm text-blue-600 hover:text-blue-800",children:"Forgot password?"})}),e.jsx(i,{type:"submit",disabled:d,className:"w-full bg-gradient-primary hover:opacity-90 text-brand-white disabled:opacity-50 font-body",children:d?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-4 h-4 mr-2 animate-spin"}),"Signing In..."]}):"Sign In"})]}):e.jsxs("div",{className:"space-y-6",children:[g===1&&e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx(u,{className:"w-8 h-8 text-white"})}),e.jsx("p",{className:"text-sm text-gray-600",children:"Quick sign-in via WhatsApp for construction professionals"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"phoneNumber",children:"Phone Number"}),e.jsx(w,{id:"phoneNumber",name:"phoneNumber",type:"tel",placeholder:"+1 (555) 123-4567",value:t.phoneNumber,onChange:N,required:!0,className:`w-full ${r.phoneNumber?"border-red-500 focus:border-red-500":""}`}),r.phoneNumber&&e.jsx("p",{className:"text-xs text-red-600",children:r.phoneNumber}),e.jsx("p",{className:"text-xs text-gray-500",children:"Enter the phone number linked to your account"})]}),e.jsx(i,{type:"submit",disabled:d,className:"w-full bg-green-500 hover:bg-green-600 text-white disabled:opacity-50 disabled:cursor-not-allowed",children:d?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-4 h-4 mr-2 animate-spin"}),"Setting up WhatsApp..."]}):e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"w-4 h-4 mr-2"}),"Sign in with WhatsApp"]})})]}),g===2&&e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("div",{className:"w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto",children:e.jsx(z,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Send WhatsApp Message"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Click the button below to open WhatsApp and send the verification message"})]}),e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:"Your verification code:"}),e.jsx("p",{className:"font-mono font-bold text-lg text-green-600",children:f})]}),e.jsxs(i,{onClick:()=>window.open(P(t.phoneNumber,f),"_blank"),className:"w-full bg-green-500 hover:bg-green-600 text-white",children:[e.jsx(u,{className:"w-4 h-4 mr-2"}),"Open WhatsApp & Send Message"]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"Message to send:"}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg text-sm text-left",children:['"Hi! I want to sign in to my bab.ai account. My verification code is: ',f,'"']})]}),e.jsx(i,{onClick:L,variant:"outline",className:"w-full mt-4",disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-4 h-4 mr-2 animate-spin"}),"Verifying..."]}):"I sent the message - Sign Me In"})]}),g===3&&e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(Q,{className:"w-16 h-16 mx-auto text-green-500"}),e.jsx("h3",{className:"text-lg font-semibold text-green-600",children:"Welcome Back!"}),e.jsx("p",{className:"text-gray-600",children:"You have successfully signed in via WhatsApp."}),e.jsx("div",{className:"p-4 bg-green-50 rounded-lg",children:e.jsx("p",{className:"text-sm text-green-600",children:"🎉 Redirecting you to your dashboard..."})})]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Don't have an account?"," ",e.jsx(i,{asChild:!0,variant:"link",className:"px-0 text-blue-600 hover:text-blue-800 font-medium",children:e.jsx(U,{to:"/register",prefetch:B.register,children:"Sign up"})})]})})]})]})]})})};export{ae as default};
